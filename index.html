<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="./css/style.css">
	<script type="text/javascript" src="http://platform.linkedin.com/in.js">
		api_key: 77lw834nbnef0f
		authorize: true
	</script>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWZWDTQeqpZqmNQA9m1ThJHcR6pqQbvgk&sensor=false">
    </script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
	</script>
    <script type="text/javascript">

	function onLinkedInAuth() {
		IN.API.Profile("me").fields("id", "first-name", "location", "positions").result( function(me) {
			var id=me.values[0].id;
			console.log(me.values[0].lastName);
			var fName=me.values[0].firstName
			var lName=me.values[0].lastName
			$.ajax({
				type: 'POST',
				url: '/request',
				data: JSON.stringify(me.values[0]),
				contentType: "application/json; charset=utf-8",
				//dataType: "string",
				complete: function(){},
				processData: false,
				success: function(){
					console.log("success");
				},
				error: function(jqXHR, textStatus, errorThrown){
					console.log("bad: " + textStatus + ": " + errorThrown);
				}
			});
		});
	}

      function initialize() {

      	geocoder = new google.maps.Geocoder();
  	    var locationsArray = new Array();

  	    var userData;

	    $.ajax({
	    	type: 'GET',
	    	url: '/map-pins',
	    	complete: function(){},
			success: function(data){
				userData = JSON.parse(data);
				console.log(data);
				console.log("success");
			},
			error: function(jqXHR, textStatus, errorThrown){
				console.log("bad: " + textStatus + ": " + errorThrown);
			}
	    });


	    geocoder.geocode( userData[0]["location"], function(results, status) {
		    if (status == google.maps.GeocoderStatus.OK) {
		      map.setCenter(results[0].geometry.location);
		      var marker = new google.maps.Marker({
		          map: map,
		          position: results[0].geometry.location
		      });
		    } else {
		      alert('Geocode was not successful for the following reason: ' + status);
		    }
		});

        var mapOptions = {
          center: new google.maps.LatLng(41.96727,-71.18495),
          zoom: 3
        };
        var map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
	<script type="IN/Login" data-onAuth="onLinkedInAuth"></script>
    <div id="map-outer"><div id="map-canvas"/></div></div>
	<div><p>CS ALUMNI</p></div>
	<div id="el"><p>stuff</p></div>
  </body>
</html>
